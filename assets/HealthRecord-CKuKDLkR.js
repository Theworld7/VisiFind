import{$ as e,B as t,C as n,E as r,F as i,G as a,I as o,J as s,K as ee,L as c,M as l,N as u,P as d,Q as f,R as p,S as te,T as m,U as h,V as ne,W as g,Y as re,Z as ie,_ as ae,a as _,b as oe,c as v,d as y,et as b,f as se,g as ce,h as le,i as ue,j as x,k as S,l as C,m as de,n as w,o as T,p as fe,q as E,rt as D,s as O,tt as k,u as A,w as j,x as pe,z as M}from"./index-PHICZ4kr.js";import{t as me}from"./useFoodLibrary-UySFGBdd.js";import{t as he}from"./useIntakeRecord-DDGx9A0h.js";var N={class:`custom-tabs`},ge={class:`tabs-header glass-white menu-container`},P=[`onClick`],F={class:`tabs-content`},_e=w(M({__name:`CustomTabs`,props:{tabs:{},modelValue:{}},emits:[`update:modelValue`],setup(e,{emit:t}){let n=e,r=f(n.modelValue);E(()=>n.modelValue,e=>{r.value=e});let i=t,s=e=>{r.value=e,i(`update:modelValue`,e)};return(t,n)=>(h(),o(`div`,N,[u(`div`,ge,[(h(!0),o(x,null,g(e.tabs,e=>(h(),o(`button`,{key:e.name,class:k([`menu-item`,{active:r.value===e.name}]),onClick:t=>s(e.name)},D(e.label),11,P))),128))]),u(`div`,F,[a(t.$slots,`default`,{},void 0,!0)])]))}}),[[`__scopeId`,`data-v-db37ff0e`]]),ve={class:`health-page`},ye={class:`tab-pane`},be={class:`intake-content`},xe={class:`intake-left`},Se={class:`intake-cards`},Ce={class:`stat-value`},we={class:`current`},Te={class:`limit`},Ee={class:`stat-value`},De={class:`current`},Oe={class:`limit`},ke={class:`stat-value`},Ae={class:`current`},je={class:`limit`},Me={class:`intake-list glass-white`},Ne={class:`meal-header`},Pe={class:`record-item`},Fe={class:`record-left`},Ie={class:`food-name`},Le={class:`record-right`},Re={class:`meal-header`},ze={class:`record-item`},Be={class:`record-left`},Ve={class:`food-name`},He={class:`record-right`},Ue={class:`meal-header`},We={class:`record-item`},Ge={class:`record-left`},Ke={class:`food-name`},qe={class:`record-right`},Je={class:`intake-right`},Ye={class:`glass-white date-picker-wrapper`},Xe={class:`limits-item`},Ze={class:`limits-item`},Qe={class:`limits-item`},$e={class:`tab-pane`},et={class:`table-header`},tt=w(M({__name:`HealthRecord`,setup(a){let{initDB:w,loadFoods:E,addFood:k,deleteFood:M,updateFood:N,foods:ge}=me(),{initDB:P,loadRecordsByDate:F,addRecord:tt,deleteRecord:nt,records:rt,dailyLimits:I,calculateDailyTotals:it,getRecordsByMealType:L,loadDailyLimits:at,saveDailyLimits:ot}=he(),R=de(),z=f([]),B=f(new Date().toISOString().split(`T`)[0]),V=f(`intake`),H=f(!1),U=f(`add`),W=ie({date:new Date().getTime(),mealType:`breakfast`,selectedFoods:[],quantity:100}),st=l(()=>W.selectedFoods.length===0?`g`:z.value.find(e=>e.id===W.selectedFoods[0])?.unit||`g`),ct=[{label:`早餐`,value:`breakfast`},{label:`午餐`,value:`lunch`},{label:`晚餐`,value:`dinner`}],lt=l(()=>z.value.map(e=>({label:e.name,value:e.id}))),ut=[{name:`intake`,label:`摄入记录`},{name:`food-library`,label:`食物库`}];l(()=>rt.value);let G=l(()=>it(B.value)),K=l(()=>L(B.value,`breakfast`)),q=l(()=>L(B.value,`lunch`)),J=l(()=>L(B.value,`dinner`));ne(async()=>{await w(),z.value=await E(),await P(),await F(B.value),await at()});let dt=async e=>{let t=new Date(e).toISOString().split(`T`)[0];B.value=t,await F(t)},Y=async()=>{await ot(I.value)},ft=[{title:`图片`,key:`image`,align:`center`,width:80,render:e=>t(v,{src:e.image,objectFit:`cover`,width:40,height:40,round:!0})},{title:`食物`,key:`name`,align:`left`,ellipsis:!0},{title:`类别`,key:`category`,align:`center`},{title:`数量/单位`,key:`quantity`,align:`center`,render:e=>`${e.quantity}${e.unit}`},{title:`碳水(g)`,key:`carbs`,align:`center`},{title:`蛋白质(g)`,key:`protein`,align:`center`},{title:`脂肪(g)`,key:`fat`,align:`center`},{title:`热量(kcal)`,key:`calories`,align:`center`},{title:`操作`,key:`actions`,align:`center`,width:120,render:e=>t(y,{justify:`center`},{default:()=>[t(j,{size:`small`,text:!0,type:`primary`,onClick:()=>ht(e)},{default:()=>`编辑`}),t(j,{size:`small`,text:!0,type:`error`,onClick:async()=>{try{await M(e.id),z.value=z.value.filter(t=>t.id!==e.id),R.success(`删除成功`)}catch{R.error(`删除失败`)}}},{default:()=>`删除`})]})}],X=f(!1),Z=f(`add`),Q=ie({image:``,name:``,category:``,quantity:100,unit:`g`,carbs:0,protein:0,fat:0,calories:0}),pt=e=>{let t=e.file.file;if(t){if(t.size>500*1024){R.warning(`图片大小不能超过 500KB`);return}let e=new FileReader;e.onload=e=>{Q.image=e.target?.result},e.readAsDataURL(t)}},mt=()=>{Object.assign(Q,{image:``,name:``,category:``,quantity:100,unit:`g`,carbs:0,protein:0,fat:0,calories:0}),Z.value=`add`,X.value=!0},ht=e=>{Object.assign(Q,{...e}),Z.value=`edit`,X.value=!0},gt=async()=>{try{if(Z.value===`edit`){await N(e(Q));let t=z.value.findIndex(e=>e.id===Q.id);t!==-1&&(z.value[t]={...e(Q),id:Q.id}),R.success(`更新成功`)}else{let t=await k(e(Q));z.value.push({...e(Q),id:t}),R.success(`保存成功`)}X.value=!1}catch{R.error(`保存失败`)}},_t=()=>{Object.assign(W,{date:new Date(B.value).getTime(),mealType:`breakfast`,selectedFoods:[],quantity:100}),U.value=`add`,H.value=!0},$=e=>{let t=e===`breakfast`?K.value:e===`lunch`?q.value:J.value;Object.assign(W,{date:new Date(B.value).getTime(),mealType:e,selectedFoods:t.map(e=>e.foodId),quantity:100}),U.value=`edit`,H.value=!0},vt=async()=>{try{let e=new Date(W.date).toISOString().split(`T`)[0];if(U.value===`edit`){let e=W.mealType===`breakfast`?K.value:W.mealType===`lunch`?q.value:J.value;for(let t of e)t.id&&await nt(t.id)}for(let t of W.selectedFoods){let n=z.value.find(e=>e.id===t);if(n){let t=W.quantity/n.quantity;await tt({foodId:n.id,foodName:n.name,foodImage:n.image,quantity:W.quantity,unit:st.value,carbs:Math.round(n.carbs*t*10)/10,protein:Math.round(n.protein*t*10)/10,fat:Math.round(n.fat*t*10)/10,calories:Math.round(n.calories*t*10)/10,mealType:W.mealType,date:e})}}H.value=!1,await F(B.value),R.success(`保存成功`)}catch{R.error(`保存失败`)}};return(e,t)=>{let a=ee(`n-scrollbar`);return h(),o(`div`,ve,[p(_e,{tabs:ut,modelValue:V.value,"onUpdate:modelValue":t[7]||=e=>V.value=e,class:`tabs-container`},{default:s(()=>[re(u(`div`,ye,[u(`div`,be,[u(`div`,xe,[p(a,{style:{"max-height":`calc(100vh - 200px)`}},{default:s(()=>[u(`div`,Se,[p(b(n),{class:`stat-card glass-white`,bordered:!1,round:``},{default:s(()=>[t[26]||=u(`div`,{class:`stat-label`},`碳水`,-1),u(`div`,Ce,[u(`span`,we,D(G.value?.carbs?.toFixed(1)||`0.0`),1),t[25]||=u(`span`,{class:`separator`},`/`,-1),u(`span`,Te,D(b(I)?.carbs||300)+`g`,1)])]),_:1}),p(b(n),{class:`stat-card glass-white`,bordered:!1,round:``},{default:s(()=>[t[28]||=u(`div`,{class:`stat-label`},`蛋白质`,-1),u(`div`,Ee,[u(`span`,De,D(G.value?.protein?.toFixed(1)||`0.0`),1),t[27]||=u(`span`,{class:`separator`},`/`,-1),u(`span`,Oe,D(b(I)?.protein||60)+`g`,1)])]),_:1}),p(b(n),{class:`stat-card glass-white`,bordered:!1,round:``},{default:s(()=>[t[30]||=u(`div`,{class:`stat-label`},`脂肪`,-1),u(`div`,ke,[u(`span`,Ae,D(G.value?.fat?.toFixed(1)||`0.0`),1),t[29]||=u(`span`,{class:`separator`},`/`,-1),u(`span`,je,D(b(I)?.fat||60)+`g`,1)])]),_:1})]),u(`div`,Me,[p(b(T),{hoverable:!1},{header:s(()=>[u(`div`,Ne,[t[32]||=u(`span`,null,`早餐`,-1),K.value.length>0?(h(),d(b(j),{key:0,text:``,type:`primary`,size:`small`,onClick:t[0]||=e=>$(`breakfast`)},{default:s(()=>[...t[31]||=[c(` 编辑 `,-1)]]),_:1})):i(``,!0)])]),default:s(()=>[K.value.length===0?(h(),d(b(_),{key:0},{default:s(()=>[p(b(r),{description:`暂无记录`})]),_:1})):i(``,!0),(h(!0),o(x,null,g(K.value,e=>(h(),d(b(_),{key:e.id},{default:s(()=>[u(`div`,Pe,[u(`div`,Fe,[p(b(v),{src:e.foodImage,"object-fit":`cover`,width:`40`,height:`40`,round:``},null,8,[`src`]),u(`span`,Ie,D(e.foodName),1)]),u(`div`,Le,[u(`span`,null,D(e.quantity)+D(e.unit),1)])])]),_:2},1024))),128))]),_:1}),p(b(T),{hoverable:!1},{header:s(()=>[u(`div`,Re,[t[34]||=u(`span`,null,`午餐`,-1),q.value.length>0?(h(),d(b(j),{key:0,text:``,type:`primary`,size:`small`,onClick:t[1]||=e=>$(`lunch`)},{default:s(()=>[...t[33]||=[c(` 编辑 `,-1)]]),_:1})):i(``,!0)])]),default:s(()=>[q.value.length===0?(h(),d(b(_),{key:0},{default:s(()=>[p(b(r),{description:`暂无记录`})]),_:1})):i(``,!0),(h(!0),o(x,null,g(q.value,e=>(h(),d(b(_),{key:e.id},{default:s(()=>[u(`div`,ze,[u(`div`,Be,[p(b(v),{src:e.foodImage,"object-fit":`cover`,width:`40`,height:`40`,round:``},null,8,[`src`]),u(`span`,Ve,D(e.foodName),1)]),u(`div`,He,[u(`span`,null,D(e.quantity)+D(e.unit),1)])])]),_:2},1024))),128))]),_:1}),p(b(T),{hoverable:!1},{header:s(()=>[u(`div`,Ue,[t[36]||=u(`span`,null,`晚餐`,-1),J.value.length>0?(h(),d(b(j),{key:0,text:``,type:`primary`,size:`small`,onClick:t[2]||=e=>$(`dinner`)},{default:s(()=>[...t[35]||=[c(` 编辑 `,-1)]]),_:1})):i(``,!0)])]),default:s(()=>[J.value.length===0?(h(),d(b(_),{key:0},{default:s(()=>[p(b(r),{description:`暂无记录`})]),_:1})):i(``,!0),(h(!0),o(x,null,g(J.value,e=>(h(),d(b(_),{key:e.id},{default:s(()=>[u(`div`,We,[u(`div`,Ge,[p(b(v),{src:e.foodImage,"object-fit":`cover`,width:`40`,height:`40`,round:``},null,8,[`src`]),u(`span`,Ke,D(e.foodName),1)]),u(`div`,qe,[u(`span`,null,D(e.quantity)+D(e.unit),1)])])]),_:2},1024))),128))]),_:1})])]),_:1})]),u(`div`,Je,[p(b(j),{class:`glass-white`,round:``,block:``,bordered:!1,onClick:_t,style:{color:`#fff`}},{default:s(()=>[...t[37]||=[c(`记录`,-1)]]),_:1}),u(`div`,Ye,[p(b(ce),{"formatted-value":B.value,"onUpdate:formattedValue":[t[3]||=e=>B.value=e,dt],type:`date`,panel:``},null,8,[`formatted-value`])]),p(b(n),{class:`glass-white daily-limits-wrapper`,bordered:!1,round:``,size:`small`},{header:s(()=>[...t[38]||=[u(`div`,{class:`card-header`},`每日摄入上限`,-1)]]),default:s(()=>[u(`div`,Xe,[t[40]||=u(`span`,null,`碳水`,-1),p(b(O),{value:b(I).carbs,"onUpdate:value":[t[4]||=e=>b(I).carbs=e,Y],min:0,size:`small`,style:{width:`100px`},"show-button":!1},{suffix:s(()=>[...t[39]||=[c(`g`,-1)]]),_:1},8,[`value`])]),u(`div`,Ze,[t[42]||=u(`span`,null,`蛋白质`,-1),p(b(O),{value:b(I).protein,"onUpdate:value":[t[5]||=e=>b(I).protein=e,Y],min:0,size:`small`,style:{width:`100px`},"show-button":!1},{suffix:s(()=>[...t[41]||=[c(`g`,-1)]]),_:1},8,[`value`])]),u(`div`,Qe,[t[44]||=u(`span`,null,`脂肪`,-1),p(b(O),{value:b(I).fat,"onUpdate:value":[t[6]||=e=>b(I).fat=e,Y],min:0,size:`small`,style:{width:`100px`},"show-button":!1},{suffix:s(()=>[...t[43]||=[c(`g`,-1)]]),_:1},8,[`value`])])]),_:1})])])],512),[[S,V.value===`intake`]]),re(u(`div`,$e,[u(`div`,et,[p(b(j),{type:`primary`,round:``,onClick:mt},{default:s(()=>[...t[45]||=[c(`新增`,-1)]]),_:1})]),p(b(ae),{columns:ft,data:z.value,bordered:!1,"single-line":!1,pagination:!1,size:`medium`},null,8,[`data`])],512),[[S,V.value===`food-library`]])]),_:1},8,[`modelValue`]),p(b(le),{show:H.value,"onUpdate:show":t[13]||=e=>H.value=e,preset:`card`,title:U.value===`add`?`新增记录`:`编辑记录`,style:{width:`400px`}},{footer:s(()=>[p(b(y),{justify:`end`},{default:s(()=>[p(b(j),{onClick:t[12]||=e=>H.value=!1},{default:s(()=>[...t[46]||=[c(`取消`,-1)]]),_:1}),p(b(j),{type:`primary`,onClick:vt},{default:s(()=>[...t[47]||=[c(`保存`,-1)]]),_:1})]),_:1})]),default:s(()=>[p(b(A),null,{default:s(()=>[p(b(C),{label:`日期`},{default:s(()=>[p(b(ce),{value:W.date,"onUpdate:value":t[8]||=e=>W.date=e,type:`date`,style:{width:`100%`}},null,8,[`value`])]),_:1}),p(b(C),{label:`餐次`},{default:s(()=>[p(b(oe),{value:W.mealType,"onUpdate:value":t[9]||=e=>W.mealType=e,"button-style":`solid`},{default:s(()=>[(h(),o(x,null,g(ct,e=>p(b(pe),{key:e.value,value:e.value},{default:s(()=>[c(D(e.label),1)]),_:2},1032,[`value`])),64))]),_:1},8,[`value`])]),_:1}),p(b(C),{label:`食物`},{default:s(()=>[p(b(te),{value:W.selectedFoods,"onUpdate:value":t[10]||=e=>W.selectedFoods=e,options:lt.value,multiple:``,filterable:``,placeholder:`搜索并选择食物`},null,8,[`value`,`options`])]),_:1}),p(b(C),{label:`数量`},{default:s(()=>[p(b(O),{value:W.quantity,"onUpdate:value":t[11]||=e=>W.quantity=e,min:1,style:{width:`100%`}},{suffix:s(()=>[c(D(st.value),1)]),_:1},8,[`value`])]),_:1})]),_:1})]),_:1},8,[`show`,`title`]),p(b(fe),{show:X.value,"onUpdate:show":t[24]||=e=>X.value=e,width:400,placement:`right`},{default:s(()=>[p(b(se),{title:Z.value===`add`?`新增食物`:`编辑食物`,closable:``},{footer:s(()=>[p(b(y),{justify:`end`},{default:s(()=>[p(b(j),{onClick:t[23]||=e=>X.value=!1},{default:s(()=>[...t[49]||=[c(`取消`,-1)]]),_:1}),p(b(j),{type:`primary`,onClick:gt},{default:s(()=>[...t[50]||=[c(`保存`,-1)]]),_:1})]),_:1})]),default:s(()=>[p(b(A),{"label-placement":`left`,"label-width":`80px`},{default:s(()=>[p(b(C),{label:`图片`},{default:s(()=>[p(b(y),{vertical:``,style:{width:`100%`}},{default:s(()=>[p(b(ue),{max:1,accept:`image/*`,"custom-request":pt,"show-file-list":!1},{default:s(()=>[p(b(j),null,{default:s(()=>[...t[48]||=[c(`上传`,-1)]]),_:1})]),_:1}),p(b(m),{value:Q.image,"onUpdate:value":t[14]||=e=>Q.image=e,placeholder:`或输入图片URL`},null,8,[`value`]),Q.image?(h(),d(b(v),{key:0,src:Q.image,"object-fit":`cover`,width:`80`,height:`80`,style:{"margin-top":`8px`,"border-radius":`8px`}},null,8,[`src`])):i(``,!0)]),_:1})]),_:1}),p(b(C),{label:`食物名称`},{default:s(()=>[p(b(m),{value:Q.name,"onUpdate:value":t[15]||=e=>Q.name=e,placeholder:`请输入食物名称`},null,8,[`value`])]),_:1}),p(b(C),{label:`类别`},{default:s(()=>[p(b(m),{value:Q.category,"onUpdate:value":t[16]||=e=>Q.category=e,placeholder:`请输入类别`},null,8,[`value`])]),_:1}),p(b(C),{label:`数量`},{default:s(()=>[p(b(O),{value:Q.quantity,"onUpdate:value":t[17]||=e=>Q.quantity=e,min:1,style:{width:`100%`}},null,8,[`value`])]),_:1}),p(b(C),{label:`单位`},{default:s(()=>[p(b(m),{value:Q.unit,"onUpdate:value":t[18]||=e=>Q.unit=e,placeholder:`如: g, ml, 个`},null,8,[`value`])]),_:1}),p(b(C),{label:`碳水(g)`},{default:s(()=>[p(b(O),{value:Q.carbs,"onUpdate:value":t[19]||=e=>Q.carbs=e,min:0,style:{width:`100%`}},null,8,[`value`])]),_:1}),p(b(C),{label:`蛋白质(g)`},{default:s(()=>[p(b(O),{value:Q.protein,"onUpdate:value":t[20]||=e=>Q.protein=e,min:0,style:{width:`100%`}},null,8,[`value`])]),_:1}),p(b(C),{label:`脂肪(g)`},{default:s(()=>[p(b(O),{value:Q.fat,"onUpdate:value":t[21]||=e=>Q.fat=e,min:0,style:{width:`100%`}},null,8,[`value`])]),_:1}),p(b(C),{label:`热量(kcal)`},{default:s(()=>[p(b(O),{value:Q.calories,"onUpdate:value":t[22]||=e=>Q.calories=e,min:0,style:{width:`100%`}},null,8,[`value`])]),_:1})]),_:1})]),_:1},8,[`title`])]),_:1},8,[`show`])])}}}),[[`__scopeId`,`data-v-fbb1d56c`]]);export{tt as default};