import{Q as e}from"./index-PHICZ4kr.js";var t=e(null);function n(){let n=e([]),r=()=>new Promise((e,n)=>{let r=indexedDB.open(`FoodLibraryDB`,1);r.onerror=()=>n(r.error),r.onsuccess=()=>{t.value=r.result,e(r.result)},r.onupgradeneeded=e=>{let t=e.target.result;t.objectStoreNames.contains(`foods`)||t.createObjectStore(`foods`,{keyPath:`id`,autoIncrement:!0})}}),i=()=>new Promise((e,r)=>{if(!t.value){r(Error(`Database not initialized`));return}let i=t.value.transaction(`foods`,`readonly`).objectStore(`foods`).getAll();i.onsuccess=()=>{n.value=i.result,e(i.result)},i.onerror=()=>r(i.error)}),a=e=>new Promise((n,r)=>{if(!t.value){r(Error(`Database not initialized`));return}let i=t.value.transaction(`foods`,`readwrite`).objectStore(`foods`).add(e);i.onsuccess=()=>{n(i.result)},i.onerror=()=>r(i.error)});return{db:t,foods:n,initDB:r,loadFoods:i,addFood:a,deleteFood:e=>new Promise((n,r)=>{if(!t.value){r(Error(`Database not initialized`));return}let i=t.value.transaction(`foods`,`readwrite`).objectStore(`foods`).delete(e);i.onsuccess=()=>{n()},i.onerror=()=>r(i.error)}),updateFood:e=>new Promise((n,r)=>{if(!t.value){r(Error(`Database not initialized`));return}let i=t.value.transaction(`foods`,`readwrite`).objectStore(`foods`).put(e);i.onsuccess=()=>{n()},i.onerror=()=>r(i.error)}),exportFoods:()=>n.value,importFoods:async e=>{if(!e||!Array.isArray(e))return 0;let t=new Set(n.value.map(e=>e.name.toLowerCase())),r=0;for(let n of e)if(!t.has(n.name.toLowerCase())){let{id:e,...i}=n;await a(i),t.add(n.name.toLowerCase()),r++}return r}}}export{n as t};