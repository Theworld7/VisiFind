import{$ as e,Q as t}from"./index-PHICZ4kr.js";var n=t(null);function r(){let r=t([]),i=t({carbs:300,protein:60,fat:60}),a=()=>new Promise((e,t)=>{let r=indexedDB.open(`IntakeRecordDB`,2);r.onerror=()=>t(r.error),r.onsuccess=()=>{n.value=r.result,e(r.result)},r.onupgradeneeded=e=>{let t=e.target.result;if(!t.objectStoreNames.contains(`records`)){let e=t.createObjectStore(`records`,{keyPath:`id`,autoIncrement:!0});e.createIndex(`date`,`date`,{unique:!1}),e.createIndex(`mealType`,`mealType`,{unique:!1})}t.objectStoreNames.contains(`settings`)||t.createObjectStore(`settings`,{keyPath:`key`})}}),o=()=>new Promise((e,t)=>{if(!n.value){t(Error(`Database not initialized`));return}let r=n.value.transaction(`settings`,`readonly`).objectStore(`settings`).get(`dailyLimits`);r.onsuccess=()=>{r.result&&(i.value=r.result.value),e(i.value)},r.onerror=()=>t(r.error)}),s=t=>{let r=e(t);return new Promise((e,t)=>{if(!n.value){t(Error(`Database not initialized`));return}let a=n.value.transaction(`settings`,`readwrite`);a.objectStore(`settings`).put({key:`dailyLimits`,value:r}),a.oncomplete=()=>{i.value=r,e()},a.onerror=()=>t(a.error)})},c=()=>new Promise((e,t)=>{if(!n.value){t(Error(`Database not initialized`));return}let i=n.value.transaction(`records`,`readonly`).objectStore(`records`).getAll();i.onsuccess=()=>{r.value=i.result,e(i.result)},i.onerror=()=>t(i.error)}),l=e=>new Promise((t,i)=>{if(!n.value){i(Error(`Database not initialized`));return}let a=n.value.transaction(`records`,`readonly`).objectStore(`records`).index(`date`).getAll(e);a.onsuccess=()=>{r.value=a.result,t(a.result)},a.onerror=()=>i(a.error)}),u=e=>new Promise((t,r)=>{if(!n.value){r(Error(`Database not initialized`));return}let i=n.value.transaction(`records`,`readwrite`).objectStore(`records`).add(e);i.onsuccess=()=>{t(i.result)},i.onerror=()=>r(i.error)});return{records:r,dailyLimits:i,initDB:a,loadRecordsByDate:l,loadRecordsByDateRange:(e,t)=>new Promise((i,a)=>{if(!n.value){a(Error(`Database not initialized`));return}let o=n.value.transaction(`records`,`readonly`).objectStore(`records`).getAll();o.onsuccess=()=>{let n=o.result.filter(n=>n.date>=e&&n.date<=t);r.value=n,i(n)},o.onerror=()=>a(o.error)}),loadAllRecords:c,addRecord:u,deleteRecord:e=>new Promise((t,r)=>{if(!n.value){r(Error(`Database not initialized`));return}let i=n.value.transaction(`records`,`readwrite`).objectStore(`records`).delete(e);i.onsuccess=()=>{t()},i.onerror=()=>r(i.error)}),calculateDailyTotals:e=>r.value?r.value.filter(t=>t.date===e).reduce((e,t)=>({carbs:e.carbs+t.carbs,protein:e.protein+t.protein,fat:e.fat+t.fat,calories:e.calories+t.calories}),{carbs:0,protein:0,fat:0,calories:0}):{carbs:0,protein:0,fat:0,calories:0},calculateRangeTotals:(e,t)=>r.value?r.value.filter(n=>n.date>=e&&n.date<=t).reduce((e,t)=>({carbs:e.carbs+t.carbs,protein:e.protein+t.protein,fat:e.fat+t.fat,calories:e.calories+t.calories}),{carbs:0,protein:0,fat:0,calories:0}):{carbs:0,protein:0,fat:0,calories:0},getDailyTotalsForRange:(e,t)=>{if(!r.value)return[];let n=[],i=new Date(e),a=new Date(t);for(let e=new Date(i);e<=a;e.setDate(e.getDate()+1)){let t=e.toISOString().split(`T`)[0],i=r.value.filter(e=>e.date===t).reduce((e,t)=>({carbs:e.carbs+t.carbs,protein:e.protein+t.protein,fat:e.fat+t.fat}),{carbs:0,protein:0,fat:0});n.push({date:t,...i})}return n},getRecordsByMealType:(e,t)=>r.value?r.value.filter(n=>n.date===e&&n.mealType===t):[],exportRecords:()=>r.value,importRecords:async e=>{if(!e||!Array.isArray(e))return 0;let t=0;for(let n of e)await u(n),t++;return t},loadDailyLimits:o,saveDailyLimits:s}}export{r as t};