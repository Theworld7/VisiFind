import{A as e,B as t,C as n,D as r,E as i,H as a,L as o,N as s,O as c,T as l,U as u,V as d,_ as f,a as p,c as m,d as h,f as g,i as _,j as v,k as y,l as b,m as x,n as S,o as C,p as w,r as T,s as E,u as D,v as O,w as k}from"./index-DhNMmnQS.js";var A=d(null);function j(){let e=d([]);return{db:A,foods:e,initDB:()=>new Promise((e,t)=>{let n=indexedDB.open(`FoodLibraryDB`,1);n.onerror=()=>t(n.error),n.onsuccess=()=>{A.value=n.result,e(n.result)},n.onupgradeneeded=e=>{let t=e.target.result;t.objectStoreNames.contains(`foods`)||t.createObjectStore(`foods`,{keyPath:`id`,autoIncrement:!0})}}),loadFoods:()=>new Promise((t,n)=>{if(!A.value){n(Error(`Database not initialized`));return}let r=A.value.transaction(`foods`,`readonly`).objectStore(`foods`).getAll();r.onsuccess=()=>{e.value=r.result,t(r.result)},r.onerror=()=>n(r.error)}),addFood:e=>new Promise((t,n)=>{if(!A.value){n(Error(`Database not initialized`));return}let r=A.value.transaction(`foods`,`readwrite`).objectStore(`foods`).add(e);r.onsuccess=()=>{t(r.result)},r.onerror=()=>n(r.error)}),deleteFood:e=>new Promise((t,n)=>{if(!A.value){n(Error(`Database not initialized`));return}let r=A.value.transaction(`foods`,`readwrite`).objectStore(`foods`).delete(e);r.onsuccess=()=>{t()},r.onerror=()=>n(r.error)})}}var M={class:`health-page`},N={class:`table-header`},P=S(y({__name:`HealthRecord`,setup(y){let{initDB:S,loadFoods:A,addFood:P,deleteFood:F,foods:I}=j(),L=w(),R=d([]);v(async()=>{await S(),R.value=await A()});let z=[{title:`图片`,key:`image`,align:`center`,width:80,render:t=>e(E,{src:t.image,objectFit:`cover`,width:40,height:40,round:!0})},{title:`食物`,key:`name`,align:`left`,ellipsis:!0},{title:`类别`,key:`category`,align:`center`},{title:`数量/单位`,key:`quantity`,align:`center`,render:e=>`${e.quantity}${e.unit}`},{title:`碳水(g)`,key:`carbs`,align:`center`},{title:`蛋白质(g)`,key:`protein`,align:`center`},{title:`脂肪(g)`,key:`fat`,align:`center`},{title:`热量(kcal)`,key:`calories`,align:`center`},{title:`操作`,key:`actions`,align:`center`,width:80,render:t=>e(f,{size:`small`,type:`error`,text:!0,onClick:async()=>{try{await F(t.id),R.value=R.value.filter(e=>e.id!==t.id),L.success(`删除成功`)}catch{L.error(`删除失败`)}}},{default:()=>`删除`})}],B=d(!1),V=t({image:``,name:``,category:``,quantity:100,unit:`g`,carbs:0,protein:0,fat:0,calories:0}),H=e=>{let t=e.file.file;t&&(V.image=URL.createObjectURL(t))},U=()=>{Object.assign(V,{image:``,name:``,category:``,quantity:100,unit:`g`,carbs:0,protein:0,fat:0,calories:0}),B.value=!0},W=async()=>{try{let e=await P(a(V));R.value.push({...a(V),id:e}),B.value=!1,L.success(`保存成功`)}catch{L.error(`保存失败`)}};return(e,t)=>(s(),i(`div`,M,[c(u(_),{closable:!1,animated:``,placement:`top`,class:`tabs-container`},{default:o(()=>[c(u(p),{name:`intake`,tab:`摄入记录`},{default:o(()=>[...t[11]||=[n(`div`,{class:`intake-content`},null,-1)]]),_:1}),c(u(p),{name:`food-library`,tab:`食物库`},{default:o(()=>[n(`div`,N,[c(u(f),{type:`primary`,round:``,onClick:U},{default:o(()=>[...t[12]||=[r(`新增`,-1)]]),_:1})]),c(u(x),{columns:z,data:R.value,bordered:!1,"single-line":!1,pagination:!1,size:`medium`},null,8,[`data`])]),_:1})]),_:1}),c(u(g),{show:B.value,"onUpdate:show":t[10]||=e=>B.value=e,width:400,placement:`right`},{default:o(()=>[c(u(h),{title:`新增食物`,closable:``},{footer:o(()=>[c(u(D),{justify:`end`},{default:o(()=>[c(u(f),{onClick:t[9]||=e=>B.value=!1},{default:o(()=>[...t[14]||=[r(`取消`,-1)]]),_:1}),c(u(f),{type:`primary`,onClick:W},{default:o(()=>[...t[15]||=[r(`保存`,-1)]]),_:1})]),_:1})]),default:o(()=>[c(u(b),{"label-placement":`left`,"label-width":`80px`},{default:o(()=>[c(u(m),{label:`图片`},{default:o(()=>[c(u(D),{vertical:``,style:{width:`100%`}},{default:o(()=>[c(u(T),{max:1,accept:`image/*`,"custom-request":H,"show-file-list":!1},{default:o(()=>[c(u(f),null,{default:o(()=>[...t[13]||=[r(`上传`,-1)]]),_:1})]),_:1}),c(u(O),{value:V.image,"onUpdate:value":t[0]||=e=>V.image=e,placeholder:`或输入图片URL`},null,8,[`value`]),V.image?(s(),k(u(E),{key:0,src:V.image,"object-fit":`cover`,width:`80`,height:`80`,style:{"margin-top":`8px`,"border-radius":`8px`}},null,8,[`src`])):l(``,!0)]),_:1})]),_:1}),c(u(m),{label:`食物名称`},{default:o(()=>[c(u(O),{value:V.name,"onUpdate:value":t[1]||=e=>V.name=e,placeholder:`请输入食物名称`},null,8,[`value`])]),_:1}),c(u(m),{label:`类别`},{default:o(()=>[c(u(O),{value:V.category,"onUpdate:value":t[2]||=e=>V.category=e,placeholder:`请输入类别`},null,8,[`value`])]),_:1}),c(u(m),{label:`数量`},{default:o(()=>[c(u(C),{value:V.quantity,"onUpdate:value":t[3]||=e=>V.quantity=e,min:1,style:{width:`100%`}},null,8,[`value`])]),_:1}),c(u(m),{label:`单位`},{default:o(()=>[c(u(O),{value:V.unit,"onUpdate:value":t[4]||=e=>V.unit=e,placeholder:`如: g, ml, 个`},null,8,[`value`])]),_:1}),c(u(m),{label:`碳水(g)`},{default:o(()=>[c(u(C),{value:V.carbs,"onUpdate:value":t[5]||=e=>V.carbs=e,min:0,style:{width:`100%`}},null,8,[`value`])]),_:1}),c(u(m),{label:`蛋白质(g)`},{default:o(()=>[c(u(C),{value:V.protein,"onUpdate:value":t[6]||=e=>V.protein=e,min:0,style:{width:`100%`}},null,8,[`value`])]),_:1}),c(u(m),{label:`脂肪(g)`},{default:o(()=>[c(u(C),{value:V.fat,"onUpdate:value":t[7]||=e=>V.fat=e,min:0,style:{width:`100%`}},null,8,[`value`])]),_:1}),c(u(m),{label:`热量(kcal)`},{default:o(()=>[c(u(C),{value:V.calories,"onUpdate:value":t[8]||=e=>V.calories=e,min:0,style:{width:`100%`}},null,8,[`value`])]),_:1})]),_:1})]),_:1})]),_:1},8,[`show`])]))}}),[[`__scopeId`,`data-v-abc4f8d5`]]);export{P as default};